(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/curstomer/addCurstomer/addAndEdit"],{124:function(e,t,o){"use strict";(function(e){o(5);r(o(4));var t=r(o(125));function r(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=o,e(t.default)}).call(this,o(1)["createPage"])},125:function(e,t,o){"use strict";o.r(t);var r=o(126),n=o(128);for(var s in n)"default"!==s&&function(e){o.d(t,e,(function(){return n[e]}))}(s);o(130),o(132);var i,c=o(11),u=Object(c["default"])(n["default"],r["render"],r["staticRenderFns"],!1,null,"61ea5618",null,!1,r["components"],i);u.options.__file="pages/curstomer/addCurstomer/addAndEdit.vue",t["default"]=u.exports},126:function(e,t,o){"use strict";o.r(t);var r=o(127);o.d(t,"render",(function(){return r["render"]})),o.d(t,"staticRenderFns",(function(){return r["staticRenderFns"]})),o.d(t,"recyclableRender",(function(){return r["recyclableRender"]})),o.d(t,"components",(function(){return r["components"]}))},127:function(e,t,o){"use strict";var r;o.r(t),o.d(t,"render",(function(){return n})),o.d(t,"staticRenderFns",(function(){return i})),o.d(t,"recyclableRender",(function(){return s})),o.d(t,"components",(function(){return r}));try{r={uniForms:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uni-forms/components/uni-forms/uni-forms")]).then(o.bind(null,270))},uniFormsItem:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uni-forms/components/uni-forms-item/uni-forms-item")]).then(o.bind(null,278))},uniEasyinput:function(){return o.e("uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput").then(o.bind(null,285))},uniDataCheckbox:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uni-data-checkbox/components/uni-data-checkbox/uni-data-checkbox")]).then(o.bind(null,328))},uniIcons:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uni-icons/components/uni-icons/uni-icons")]).then(o.bind(null,320))},uniDrawer:function(){return o.e("uni_modules/uni-drawer/components/uni-drawer/uni-drawer").then(o.bind(null,337))},uniRow:function(){return o.e("uni_modules/uni-row/components/uni-row/uni-row").then(o.bind(null,344))},uniCol:function(){return o.e("uni_modules/uni-row/components/uni-col/uni-col").then(o.bind(null,351))},uniPopup:function(){return o.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(o.bind(null,313))}}}catch(c){if(-1===c.message.indexOf("Cannot find module")||-1===c.message.indexOf(".vue"))throw c;console.error(c.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var n=function(){var e=this,t=e.$createElement;e._self._c},s=!1,i=[];n._withStripped=!0},128:function(e,t,o){"use strict";o.r(t);var r=o(129),n=o.n(r);for(var s in r)"default"!==s&&function(e){o.d(t,e,(function(){return r[e]}))}(s);t["default"]=n.a},129:function(e,t,o){"use strict";(function(e){function o(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function r(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function n(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s={name:"addAndEdit",data:function(){return{curstomerForm:{contacts:"",contactNumber:"",weChatNumber:"",customerName:"",duties:"",customerLable:[],contactAddress:"",resources:"",remarks:"",shareUserName:[],shareUserId:"",province:"",city:"",county:"",creator:"",createBy:""},customerLables:[],chooseProVal:{},applyUserNameList:[],personnel:"",cusIcon:"/static/icon/scan",rules:{contacts:{rules:[{required:!0,errorMessage:"必填"}]},customerLable:{rules:[{required:!0,errorMessage:"请至少选择一项"}]},province:{rules:[{required:!0,errorMessage:"必填"}]},city:{rules:[{required:!0,errorMessage:"必填"}]}},UserNameArray:[],flagPhoneNumber:!1,resPhoneTitle:"",resWeChatTitle:"",isDisable:!1}},onLoad:function(e){var t=this;if(e.ocrData){var o=JSON.parse(e.ocrData);o.map((function(e){if("姓名"==e.Name)t.curstomerForm.contacts=e.Value;else if("职位"==e.Name)t.curstomerForm.duties=e.Value;else if("公司"==e.Name)t.curstomerForm.customerName=e.Value;else if("微信"==e.Name)t.curstomerForm.weChatNumber=e.Value;else{if("手机"==e.Name)return void(e.Value.length>11?t.curstomerForm.contactNumber=e.Value.substring(e.Value.length-11,e.Value.length):t.curstomerForm.contactNumber=e.Value);"地址"==e.Name&&(t.curstomerForm.contactAddress=e.Value,-1!=t.curstomerForm.contactAddress.indexOf("省")&&(t.curstomerForm.province=t.curstomerForm.contactAddress.split("省")[0]+"省"),-1!=t.curstomerForm.contactAddress.indexOf("市")&&(t.curstomerForm.city=t.curstomerForm.contactAddress.split("市")[0]+"市"),-1!=t.curstomerForm.contactAddress.indexOf("区")&&(-1!=t.curstomerForm.contactAddress.indexOf("市")?t.curstomerForm.county=t.curstomerForm.contactAddress.split("市")[1].split("区")[0]+"区":t.curstomerForm.county=t.curstomerForm.contactAddress.split("区")[0]+"区"))}}))}},mounted:function(){this.curstomerForm.creator=e.getStorageSync("userName"),this.curstomerForm.createBy=e.getStorageSync("loginName"),this.getDictApply()},methods:{getDictApply:function(){var t=this;this.$request("/applyIn/listDictApply","POST",{},{"content-type":"application/x-www-form-urlencoded",cookie:e.getStorageSync("setCookie")}).then((function(o){"login"==o||500==o.code&&o.msg.includes("Authentication")?(e.setStorageSync("loginSuccess",!1),setTimeout((function(){e.showToast({title:"登录已失效！",icon:"error",duration:3e3}),setTimeout((function(){e.switchTab({url:"/pages/home/index",success:function(){var e=getCurrentPages().pop();e&&e.onLoad()}})}),3e3)}),1e3)):t.customerLables=o.data.sysCustomerDicts.map((function(e,t){return{text:e,value:t}}))}))},getApplyUserNameList:function(){var t=this;this.$request("/system/user/list","POST",{userName:this.personnel},{"content-type":"application/x-www-form-urlencoded",cookie:e.getStorageSync("setCookie")}).then((function(o){"login"==o||500==o.code&&o.msg.includes("Authentication")?(e.setStorageSync("loginSuccess",!1),setTimeout((function(){e.showToast({title:"登录已失效！",icon:"error",duration:3e3}),setTimeout((function(){e.switchTab({url:"/pages/home/index",success:function(){var e=getCurrentPages().pop();e&&e.onLoad()}})}),3e3)}),1e3)):t.applyUserNameList=o.rows}))},checkboxChange:function(e){console.log("e",e)},submit:function(){var t=this,o=!1,n=!1;this.isDisable=!0,this.$refs.form.validate().then((function(s){if(t.applyUserNameList.map((function(e){t.curstomerForm.shareUserName.map((function(o){e.userName==o&&(t.UserNameArray.push(e.userId),t.curstomerForm.shareUserId=t.UserNameArray.toString())}))})),""==t.curstomerForm.contactNumber&&""==t.curstomerForm.weChatNumber)return wx.showToast({title:"联系电话和微信号必须填写其中一个！",icon:"none",duration:4e3}),void(t.isDisable=!1);if(""!=t.curstomerForm.contactNumber)for(var i=t.curstomerForm.contactNumber.split("/"),c=0;c<i.length;c++)if(!/^1[3|4|5|6|7|8|9][0-9]\d{4,8}$/.test(i[c]))return wx.showToast({title:"请输入正确的手机号！",icon:"none",duration:4e3}),t.isDisable=!1,!0;t.$request("/system/customer/checkPhoneUnique","POST",r({},t.curstomerForm),{"content-type":"application/x-www-form-urlencoded",cookie:e.getStorageSync("setCookie")}).then((function(r){if("login"==r||500==r.code&&r.msg.includes("Authentication"))e.setStorageSync("loginSuccess",!1),setTimeout((function(){e.showToast({title:"登录已失效！",icon:"error",duration:3e3}),setTimeout((function(){e.switchTab({url:"/pages/home/index",success:function(){var e=getCurrentPages().pop();e&&e.onLoad()}})}),3e3)}),1e3);else{if(""!=r)return t.resPhoneTitle=r.slice(0,r.length-1),t.$refs.popupPhone.open(),setTimeout((function(){t.$refs.popupPhone.close(),t.resPhoneTitle=""}),5e3),void(t.isDisable=!1);o=!0}})).catch((function(e){console.log("err",e)})),t.$request("/system/customer/checkWeChatNumberUnique","POST",r({},t.curstomerForm),{"content-type":"application/x-www-form-urlencoded",cookie:e.getStorageSync("setCookie")}).then((function(o){if("login"==o||500==o.code&&o.msg.includes("Authentication"))e.setStorageSync("loginSuccess",!1),setTimeout((function(){e.showToast({title:"登录已失效！",icon:"error",duration:3e3}),setTimeout((function(){e.switchTab({url:"/pages/home/index",success:function(){var e=getCurrentPages().pop();e&&e.onLoad()}})}),3e3)}),1e3);else{if(""!=o)return t.resWeChatTitle=o.slice(0,o.length-1),t.$refs.popupPhone.open(),setTimeout((function(){t.$refs.popupPhone.close(),t.resWeChatTitle=""}),5e3),void(t.isDisable=!1);n=!0}})),setTimeout((function(){o&&n&&(e.showLoading({title:"提交中..."}),t.$request("/system/customer/add","POST",r({},t.curstomerForm),{"content-type":"application/x-www-form-urlencoded",cookie:e.getStorageSync("setCookie")}).then((function(t){"login"==t||500==t.code&&t.msg.includes("Authentication")?(e.setStorageSync("loginSuccess",!1),setTimeout((function(){e.showToast({title:"登录已失效！",icon:"error",duration:3e3}),setTimeout((function(){e.switchTab({url:"/pages/home/index",success:function(){var e=getCurrentPages().pop();e&&e.onLoad()}})}),3e3)}),1e3)):(e.hideLoading(),e.redirectTo({url:"../index"}),console.log("客户接口",t))})).catch((function(e){console.log("表单错误信息：",e)})))}),1e3)})).catch((function(e){t.isDisable=!1}))},resetForm:function(){this.$refs.form.resetFields(),this.curstomerForm.shareUserName=[],this.curstomerForm.shareUserId=""},showProRight:function(){this.personnel="",this.getApplyUserNameList(),this.$refs.showProRight.open()},showSharerProRight:function(){this.personnel="",this.getApplyUserNameList(),this.$refs.showSharerProRight.open()},choosePro:function(e){this.curstomerForm.creator=e.userName,this.curstomerForm.createBy=e.loginName,this.$refs.showProRight.close()},checkChange:function(e){this.curstomerForm.shareUserName=e.target.value},closeProDrawer:function(){this.$refs.showProRight.close()},closeProDrawerShare:function(){this.$refs.showSharerProRight.close()},searchProShare:function(){this.getApplyUserNameList()},curstomerIcon:function(){e.redirectTo({url:"../../ocr/index"})}}};t.default=s}).call(this,o(1)["default"])},130:function(e,t,o){"use strict";o.r(t);var r=o(131),n=o.n(r);for(var s in r)"default"!==s&&function(e){o.d(t,e,(function(){return r[e]}))}(s);t["default"]=n.a},131:function(e,t,o){},132:function(e,t,o){"use strict";o.r(t);var r=o(133),n=o.n(r);for(var s in r)"default"!==s&&function(e){o.d(t,e,(function(){return r[e]}))}(s);t["default"]=n.a},133:function(e,t,o){}},[[124,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../../.sourcemap/mp-weixin/pages/curstomer/addCurstomer/addAndEdit.js.map