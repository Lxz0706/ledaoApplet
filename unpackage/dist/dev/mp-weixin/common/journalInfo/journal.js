(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["common/journalInfo/journal"],{183:function(e,t,n){"use strict";(function(e,t){var o=n(4);n(26);o(n(25));var i=o(n(184));e.__webpack_require_UNI_MP_PLUGIN__=n,t(i.default)}).call(this,n(1)["default"],n(2)["createPage"])},184:function(e,t,n){"use strict";n.r(t);var o=n(185),i=n(187);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);n(192),n(194);var a,s=n(32),c=Object(s["default"])(i["default"],o["render"],o["staticRenderFns"],!1,null,"63a98d17",null,!1,o["components"],a);c.options.__file="common/journalInfo/journal.vue",t["default"]=c.exports},185:function(e,t,n){"use strict";n.r(t);var o=n(186);n.d(t,"render",(function(){return o["render"]})),n.d(t,"staticRenderFns",(function(){return o["staticRenderFns"]})),n.d(t,"recyclableRender",(function(){return o["recyclableRender"]})),n.d(t,"components",(function(){return o["components"]}))},186:function(e,t,n){"use strict";var o;n.r(t),n.d(t,"render",(function(){return i})),n.d(t,"staticRenderFns",(function(){return a})),n.d(t,"recyclableRender",(function(){return r})),n.d(t,"components",(function(){return o}));try{o={uniForms:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-forms/components/uni-forms/uni-forms")]).then(n.bind(null,698))},uniFormsItem:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-forms/components/uni-forms-item/uni-forms-item")]).then(n.bind(null,707))},uniEasyinput:function(){return n.e("uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput").then(n.bind(null,714))},uniIcons:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-icons/components/uni-icons/uni-icons")]).then(n.bind(null,749))},uniDateformat:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-dateformat/components/uni-dateformat/uni-dateformat")]).then(n.bind(null,817))},uniFab:function(){return n.e("uni_modules/uni-fab/components/uni-fab/uni-fab").then(n.bind(null,823))},uniPopup:function(){return n.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(n.bind(null,742))},uniDrawer:function(){return n.e("uni_modules/uni-drawer/components/uni-drawer/uni-drawer").then(n.bind(null,767))},uniRow:function(){return n.e("uni_modules/uni-row/components/uni-row/uni-row").then(n.bind(null,774))},uniCol:function(){return n.e("uni_modules/uni-row/components/uni-col/uni-col").then(n.bind(null,781))}}}catch(s){if(-1===s.message.indexOf("Cannot find module")||-1===s.message.indexOf(".vue"))throw s;console.error(s.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var i=function(){var e=this,t=e.$createElement;e._self._c;e._isMounted||(e.e0=function(t){!e.showAdd&&1!=e.isChat&&e.showProRight()})},r=!1,a=[];i._withStripped=!0},187:function(e,t,n){"use strict";n.r(t);var o=n(188),i=n.n(o);for(var r in o)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(r);t["default"]=i.a},188:function(e,t,n){"use strict";(function(e){var o=n(4);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=o(n(189)),r=o(n(11)),a=o(n(191));function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var u={name:"journal",data:function(){return{formData:{workDetail:"",chatDetail:"",proId:"",projectName:"",userName:[],id:""},rules:{workDetail:{rules:[{required:!0,errorMessage:"必填"}]},projectName:{rules:[{required:!0,errorMessage:"必填"}]}},userList:[],chooseUserVals:"",isChat:0,isManager:!1,chooseProVal:{},projectList:[],stepOption:[],fileList:[],isShowTitle:!1,dateTimeDis:!1,chatDetailA:[],setFocus:!1,indexV:"",Reply:"",loginName:"",detailsList:[],journalId:"",journalCommentId:"",projectNameSearch:"",showChatAll:!1,showAdd:!1,proIds:"",createBy:"",replyName:"",replyBy:"",holder:"",journalTimeList:[],journalTimeMsg:"",projectType:"",startTime:"",enTime:""}},watch:{holder:function(){this.holder="回复  "+this.replyName}},onLoad:function(t){if(t.item){var n=JSON.parse(t.item);this.formData=n,this.proIds=n.proId}this.isChat=t.isChat,this.createBy=t.createBy,this.loginName=e.getStorageSync("userName")},mounted:function(){this.getJournalTime();var e=this;e.init()},methods:{init:function(){var e=this;return(0,a.default)(i.default.mark((function t(){var n;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:1==e.isChat&&e.getChatDetailList(),n=e,console.log(n.startTime+"====="+n.enTime);case 3:case"end":return t.stop()}}),t)})))()},getChatDetailList:function(){var t=this;return(0,a.default)(i.default.mark((function n(){return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:t.$request("/system/comment/listCommentDtail","POST",{journalId:null==t.formData.id?"":t.formData.id,proId:t.proIds,commentTime:e.getStorageSync("datePeople")},{"content-type":"application/x-www-form-urlencoded",cookie:e.getStorageSync("setCookie")}).then((function(n){"login"==n||500==n.code&&n.msg.includes("Authentication")?(e.setStorageSync("loginSuccess",!1),setTimeout((function(){e.showToast({title:"登录已失效！",icon:"error",duration:3e3}),setTimeout((function(){e.switchTab({url:"/pages/home/index",success:function(){var e=getCurrentPages().pop();e&&e.onLoad()}})}),3e3)}),1e3)):(t.chatDetailA=n.data,t.formData.chatDetail="",t.chatDetailA.length>0&&(t.showChatAll=!0,t.formData.id=n.data[0].journalId))}));case 1:case"end":return n.stop()}}),n)})))()},jonClick:function(){var t=this;this.$request("/system/comment/add","POST",{parentId:this.journalCommentId,chatDetail:this.Reply,journalId:this.formData.id,commentTime:e.getStorageSync("datePeople"),temporaryName:this.createBy,replyBy:this.replyBy,replyName:this.replyName},{"content-type":"application/x-www-form-urlencoded",cookie:e.getStorageSync("setCookie")}).then((function(n){"login"==n||500==n.code&&n.msg.includes("Authentication")?(e.setStorageSync("loginSuccess",!1),setTimeout((function(){e.showToast({title:"登录已失效！",icon:"error",duration:3e3}),setTimeout((function(){e.switchTab({url:"/pages/home/index",success:function(){var e=getCurrentPages().pop();e&&e.onLoad()}})}),3e3)}),1e3)):0==n.code&&t.getChatDetailList()}))},fabClick:function(){e.redirectTo({url:"./journalone"})},getProList:function(){var t=this;e.showLoading({title:"加载中...",mask:!0}),this.$request("/system/project/listProTh","POST",{projectName:this.projectNameSearch},{"content-type":"application/x-www-form-urlencoded",cookie:e.getStorageSync("setCookie")}).then((function(n){"login"==n||500==n.code&&n.msg.includes("Authentication")?(e.setStorageSync("loginSuccess",!1),setTimeout((function(){e.showToast({title:"登录已失效！",icon:"error",duration:3e3}),setTimeout((function(){e.switchTab({url:"/pages/home/index",success:function(){var e=getCurrentPages().pop();e&&e.onLoad()}})}),3e3)}),1e3)):(0==n.code&&(n.data.length>0?t.projectList=n.data:(t.projectList=[],t.isShowTitle=!0,e.showToast({icon:"error",position:"bottom",title:"没有更多了"}))),e.hideLoading())}))},submit:function(){var e=this;setTimeout((function(){e.submitJournal()}),500)},submitJournal:function(){var t=this;return(0,a.default)(i.default.mark((function n(){return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:t.$refs.form.validate().then((function(n){t.$request("/system/journal/add","POST",c({},t.formData),{"content-type":"application/x-www-form-urlencoded",cookie:e.getStorageSync("setCookie")}).then((function(n){if("login"==n||500==n.code&&n.msg.includes("Authentication"))setTimeout((function(){e.showToast({title:"登录已失效！",icon:"error",duration:3e3}),setTimeout((function(){e.switchTab({url:"/pages/home/index",success:function(){var e=getCurrentPages().pop();e&&e.onLoad()}})}),3e3)}),1e3);else if(0==n.code)t.showAdd=!0,setTimeout((function(){e.showToast({title:"提交成功",icon:"success",duration:3e3})}),500);else{console.log(n.msg);var o=n.msg;setTimeout((function(){e.showToast({title:o,icon:"none",mask:!0,duration:3e3})}),500)}}))})).catch((function(e){console.log("err",e)}));case 1:case"end":return n.stop()}}),n)})))()},submitIsChat:function(){var t=this;""==this.formData.chatDetail||void 0==this.formData.chatDetail?e.showToast({title:"评论内容不能为空",duration:3e3,icon:"none"}):this.$refs.form.validate().then((function(n){t.$request("/system/comment/add","POST",{journalId:null==t.formData.id?"":t.formData.id,proId:t.proIds,workDetail:t.formData.chatDetail,remarks1:0,commentTime:e.getStorageSync("datePeople"),temporaryName:t.createBy},{"content-type":"application/x-www-form-urlencoded",cookie:e.getStorageSync("setCookie")}).then((function(n){"login"==n||500==n.code&&n.msg.includes("Authentication")?setTimeout((function(){e.showToast({title:"登录已失效！",icon:"error"}),setTimeout((function(){e.switchTab({url:"/pages/home/index",success:function(){var e=getCurrentPages().pop();e&&e.onLoad()}})}),3e3)}),1e3):(0==n.code&&(t.$refs.chatDetail.val="",t.getChatDetailList()),console.log("IsChat",n))}))})).catch((function(e){}))},huifuClick:function(e,t,n,o){this.$refs.popup.open("bottom"),this.setFocus=!0,this.indexV=e,this.journalCommentId=t,this.replyBy=n,this.replyName=o,this.holder="回复："+o},send:function(){""==this.Reply?e.showToast({title:"回复内容不能为空",duration:2e3,icon:"none"}):this.jonClick(),this.Reply="",this.$refs.popup.close()},showProRight:function(){this.getProList(),this.$refs.showProRight.open()},closeProDrawer:function(){this.$refs.showProRight.close()},inputFocus:function(){this.dateTimeDis&&0==this.isChat&&e.showToast({title:this.journalTimeMsg+"，请在规定时间内填写",icon:"none"})},choosePro:function(t){var n=this;n.$request("/system/journal/listByProId","POST",{proId:t.projectId},{"content-type":"application/x-www-form-urlencoded",cookie:e.getStorageSync("setCookie")}).then((function(o){"login"==o||500==o.code&&o.msg.includes("Authentication")?setTimeout((function(){e.showToast({title:"登录已失效！",icon:"error",duration:3e3}),setTimeout((function(){e.switchTab({url:"/pages/home/index",success:function(){var e=getCurrentPages().pop();e&&e.onLoad()}})}),3e3)}),1e3):o.rows.length>0?e.showModal({title:"该项目日志已存在，是否继续编辑？",success:function(e){e.confirm?(console.log("用户点击确定"),0==o.rows[0].proId?n.formData.projectName="无项目":n.formData.projectName=o.rows[0].projectName,n.formData.workDetail=o.rows[0].workDetail,n.formData.proId=o.rows[0].projectId,n.formData.id=o.rows[0].id,n.$refs.showProRight.close()):e.cancel}}):(n.formData.projectName=t.projectName,n.formData.proId=t.projectId,n.formData.projectType=t.projectType,n.$refs.showProRight.close())}))},searchPro:function(){this.getProList()},getJournalTime:function(){var t=this;this.$request("/system/journal/getJournalTime","POST",{},{"content-type":"application/x-www-form-urlencoded",cookie:e.getStorageSync("setCookie")}).then((function(n){t.journalTimeList=n.data;var o="";for(var i in n.data)o=n.data[i].configValue,t.journalTimeMsg=n.data[0].remark;var r="";for(var a in o.split(","))r+=o.split(",")[a]+",";var s=r.substring(0,r.lastIndexOf(","));t.startTime=s.split(",")[0].replace(/-/gi,"/"),t.enTime=s.split(",")[1].replace(/-/gi,"/"),t.dateTimeDis=t.checkAuditTime(s.split(",")[0].replace(/-/gi,"/"),s.split(",")[1].replace(/-/gi,"/")),e.hideLoading()}))},checkAuditTime:function(e,t){console.log(e+"=====-----------"+t);var n=new Date,o=("".concat(n.getFullYear(),"-").concat(n.getMonth()+1,"-").concat(n.getDate()," "),new Date(e).getTime()),i=new Date(t).getTime(),r=n.getTime(),a=o<i;return r>o&&r<i?!a:!!a}}};t.default=u}).call(this,n(2)["default"])},192:function(e,t,n){"use strict";n.r(t);var o=n(193),i=n.n(o);for(var r in o)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(r);t["default"]=i.a},193:function(e,t,n){},194:function(e,t,n){"use strict";n.r(t);var o=n(195),i=n.n(o);for(var r in o)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(r);t["default"]=i.a},195:function(e,t,n){}},[[183,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/common/journalInfo/journal.js.map